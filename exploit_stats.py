

# Quelques imports

import torch
import torch.nn as nn
import torchvision
from models.cnn import mnistConv
from matplotlib import pyplot as plt
import torch.nn.functional as F
import numpy as np
from scipy.special import softmax

from torch.optim import Adam

import pickle as pk



stats = pk.load(open('stats/stats.dat', 'rb'))



N = len(stats)
adv_trains = [0.1, 0.5, 1., 1.5, 2., 5., 10., 20., 30., 50.]

attack_name = "LinfPGDAttack"
names = [f"{attack_name}_{str(adv)}" for adv in adv_trains ]

for t in range(10):
    fig, axs = plt.subplots(10, len(names), figsize=(125, 50))

    for k, key in enumerate(names):
        v = stats[key]
            
        for i in range(10):
            axs[i][k].imshow(v['proba_maps'][t][i].reshape(28, 28), cmap='gray')
            if i == 0:
                axs[i][k].set_title(key)
            axs[i][k].axis('off')
    fig.tight_layout()

    fig.savefig(f"tmp/proba_maps_samples_{attack_name}_{t}.png")


print(stats.keys())
